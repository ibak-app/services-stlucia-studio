<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Services Directory — Saint Lucia | stlucia.studio</title>
<meta name="description" content="Every service you need in Saint Lucia. 847 verified providers — transport, tours, dining, arts, entertainment, home services, and more.">
<meta property="og:title" content="Saint Lucia Services Directory">
<meta property="og:description" content="847 verified local service providers in Saint Lucia. Browse, search, and explore.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://services.stlucia.studio">
<link rel="canonical" href="https://services.stlucia.studio">
<meta name="theme-color" content="#0D7377">

<!-- Analytics -->
<script defer data-domain="services.stlucia.studio" src="https://plausible.io/js/script.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0GXK2QMVPZ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-0GXK2QMVPZ');</script>
<script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','1403025764621663');fbq('track','PageView');</script>

<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --teal:#0D7377;--teal-l:#11999E;--teal-d:#065355;
  --gold:#F4A100;--gold-l:#FFD166;--mint:#06D6A0;--coral:#EF476F;
  --bg:#F7F8FA;--surface:#fff;--border:#E2E8F0;--muted:#718096;
  --text:#1A202C;--text-sm:#4A5568;
  --r:12px;--font:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;
  --safe-b:env(safe-area-inset-bottom,0px);
}
html{font-size:15px;scroll-behavior:smooth;-webkit-text-size-adjust:100%}
body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.55;
  min-height:100vh;min-height:100dvh;padding-bottom:var(--safe-b)}
a{color:var(--teal);text-decoration:none}

/* === HEADER === */
.hdr{background:linear-gradient(135deg,#0B1622 0%,#0D7377 60%,#11999E 100%);
  color:#fff;padding:.75rem 1rem;position:sticky;top:0;z-index:100;
  box-shadow:0 2px 12px rgba(0,0,0,.25);display:flex;align-items:center;gap:.75rem}
.hdr-brand{font-size:1rem;font-weight:900;letter-spacing:-.02em;white-space:nowrap}
.hdr-brand span{color:var(--gold)}
.hdr-search{flex:1;position:relative}
.hdr-search input{width:100%;height:36px;border:none;border-radius:20px;padding:0 .9rem 0 2.2rem;
  font-size:.82rem;font-family:var(--font);background:rgba(255,255,255,.15);color:#fff;outline:none}
.hdr-search input::placeholder{color:rgba(255,255,255,.6)}
.hdr-search input:focus{background:rgba(255,255,255,.25)}
.hdr-search svg{position:absolute;left:.7rem;top:50%;transform:translateY(-50%);opacity:.6}
.hdr-back{background:none;border:none;color:#fff;font-size:1.3rem;cursor:pointer;padding:.2rem;
  line-height:1;display:none}

/* === STATS BAR === */
.stats-bar{display:flex;justify-content:center;gap:1.5rem;padding:.6rem 1rem;
  background:var(--surface);border-bottom:1px solid var(--border)}
.stat-pill{text-align:center}
.stat-pill strong{display:block;font-size:1rem;font-weight:900;color:var(--teal)}
.stat-pill small{font-size:.6rem;color:var(--muted);text-transform:uppercase;letter-spacing:.04em}

/* === GROUP GRID (HOME) === */
.section-title{padding:1rem 1rem .5rem;font-size:.9rem;font-weight:800;color:var(--text)}
.group-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.6rem;padding:0 1rem .75rem}
@media(min-width:640px){.group-grid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:900px){.group-grid{grid-template-columns:repeat(4,1fr)}}
.group-card{background:var(--surface);border:2px solid var(--border);border-radius:var(--r);
  padding:.75rem;display:flex;align-items:center;gap:.6rem;cursor:pointer;
  transition:all .15s;-webkit-tap-highlight-color:transparent}
.group-card:hover{border-color:var(--teal);box-shadow:0 4px 12px rgba(13,115,119,.12);transform:translateY(-1px)}
.group-card:active{transform:translateY(0)}
.group-icon{font-size:1.6rem;flex-shrink:0}
.group-info{flex:1;min-width:0}
.group-name{font-size:.82rem;font-weight:700;line-height:1.2}
.group-count{font-size:.65rem;color:var(--teal);font-weight:700}

/* === SERVICE CARDS === */
.cards{display:grid;grid-template-columns:1fr;gap:.5rem;padding:0 1rem .75rem}
@media(min-width:640px){.cards{grid-template-columns:repeat(2,1fr)}}
@media(min-width:900px){.cards{grid-template-columns:repeat(3,1fr)}}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);
  padding:.75rem;border-left:4px solid var(--border);transition:box-shadow .15s}
.card:hover{box-shadow:0 2px 8px rgba(0,0,0,.08)}
.card-name{font-size:.85rem;font-weight:700;color:var(--text);margin-bottom:.2rem}
.card-desc{font-size:.72rem;color:var(--text-sm);line-height:1.4;margin-bottom:.35rem;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.card-area{font-size:.65rem;color:var(--muted);margin-bottom:.4rem}
.card-actions{display:flex;gap:.4rem;flex-wrap:wrap}
.card-btn{display:inline-flex;align-items:center;gap:.25rem;padding:.3rem .6rem;
  border-radius:16px;font-size:.68rem;font-weight:600;text-decoration:none;
  transition:opacity .15s;line-height:1.2}
.card-btn:hover{opacity:.85}
.btn-call{background:#E6FFFA;color:var(--teal)}
.btn-wa{background:#DCF8C6;color:#128C7E}
.btn-web{background:#EBF4FF;color:#2B6CB0}
.card-cat{font-size:.6rem;color:var(--muted);margin-top:.35rem;padding-top:.35rem;
  border-top:1px solid var(--border)}

/* === SUBCAT CHIPS === */
.chip-bar{display:flex;gap:.4rem;padding:.6rem 1rem;overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none}
.chip-bar::-webkit-scrollbar{display:none}
.chip{display:inline-flex;align-items:center;gap:.25rem;padding:.35rem .7rem;border-radius:20px;
  font-size:.72rem;font-weight:600;cursor:pointer;white-space:nowrap;border:2px solid transparent;
  transition:all .15s;-webkit-tap-highlight-color:transparent;flex-shrink:0}
.chip:hover{opacity:.85}
.chip.active{border-color:var(--text);box-shadow:0 2px 6px rgba(0,0,0,.15)}
.chip-count{font-size:.6rem;font-weight:700;opacity:.7}

/* === PERSONA CHIPS (secondary) === */
.persona-strip{display:flex;gap:.4rem;padding:.5rem 1rem;overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none;background:var(--surface);border-bottom:1px solid var(--border)}
.persona-strip::-webkit-scrollbar{display:none}
.persona-chip{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .65rem;
  border-radius:20px;font-size:.7rem;font-weight:600;cursor:pointer;white-space:nowrap;
  background:var(--bg);border:1.5px solid var(--border);transition:all .15s;flex-shrink:0}
.persona-chip:hover,.persona-chip.active{border-color:var(--teal);background:#E6FFFA;color:var(--teal)}

/* === EXPLORE BUTTON === */
.explore-cta{margin:1rem;padding:1rem;background:linear-gradient(135deg,#0D7377,#11999E);
  color:#fff;border-radius:var(--r);text-align:center;cursor:pointer;
  transition:transform .15s;-webkit-tap-highlight-color:transparent}
.explore-cta:hover{transform:translateY(-2px)}
.explore-cta:active{transform:translateY(0)}
.explore-cta-icon{font-size:2rem;margin-bottom:.3rem}
.explore-cta-title{font-size:1rem;font-weight:800}
.explore-cta-sub{font-size:.72rem;opacity:.8;margin-top:.15rem}

/* === TIKTOK EXPLORE VIEW === */
.explore-view{position:fixed;top:0;left:0;right:0;bottom:0;z-index:200;background:#0B1622;
  display:none;overflow:hidden}
.explore-view.active{display:flex;flex-direction:column}
.explore-hdr{display:flex;align-items:center;justify-content:space-between;padding:.6rem 1rem;
  background:rgba(0,0,0,.4);color:#fff;position:absolute;top:0;left:0;right:0;z-index:10}
.explore-close{background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;padding:.2rem}
.explore-shuffle{background:rgba(255,255,255,.2);border:none;color:#fff;padding:.35rem .8rem;
  border-radius:20px;font-size:.72rem;font-weight:700;cursor:pointer}
.explore-filter-btn{background:rgba(255,255,255,.2);border:none;color:#fff;padding:.35rem .8rem;
  border-radius:20px;font-size:.72rem;font-weight:700;cursor:pointer}
.explore-counter{font-size:.7rem;color:rgba(255,255,255,.7)}

.explore-scroll{flex:1;overflow-y:auto;scroll-snap-type:y mandatory;-webkit-overflow-scrolling:touch}
.explore-card{min-height:100vh;min-height:100dvh;scroll-snap-align:start;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  padding:4rem 2rem 3rem;text-align:center;color:#fff;position:relative}
.explore-card-cat-icon{font-size:3rem;margin-bottom:1rem;opacity:.8}
.explore-card-name{font-size:1.6rem;font-weight:900;line-height:1.2;margin-bottom:.6rem}
.explore-card-desc{font-size:.9rem;line-height:1.5;opacity:.9;max-width:500px;margin-bottom:1rem}
.explore-card-area{font-size:.8rem;opacity:.7;margin-bottom:1.5rem}
.explore-card-actions{display:flex;gap:.6rem;flex-wrap:wrap;justify-content:center;margin-bottom:1.5rem}
.explore-card-btn{display:inline-flex;align-items:center;gap:.3rem;padding:.5rem 1rem;
  border-radius:24px;font-size:.8rem;font-weight:700;text-decoration:none;
  background:rgba(255,255,255,.2);color:#fff;backdrop-filter:blur(4px);border:1px solid rgba(255,255,255,.2)}
.explore-card-btn:hover{background:rgba(255,255,255,.35)}
.explore-card-meta{font-size:.7rem;opacity:.5}
.explore-swipe-hint{position:absolute;bottom:2rem;left:50%;transform:translateX(-50%);
  font-size:.7rem;opacity:.4;animation:bounce 2s infinite}
@keyframes bounce{0%,100%{transform:translateX(-50%) translateY(0)}50%{transform:translateX(-50%) translateY(-6px)}}

/* === FILTER OVERLAY (explore) === */
.explore-filters{position:absolute;top:3rem;left:0;right:0;z-index:11;
  background:rgba(0,0,0,.85);backdrop-filter:blur(8px);padding:.75rem;
  display:none;max-height:40vh;overflow-y:auto}
.explore-filters.active{display:block}
.explore-filters .chip{color:#fff;border-color:rgba(255,255,255,.3)}
.explore-filters .chip.active{border-color:#fff;background:rgba(255,255,255,.15)}

/* === CATEGORY HEADER === */
.cat-header{background:var(--surface);padding:.75rem 1rem;border-bottom:1px solid var(--border);
  display:flex;align-items:center;gap:.6rem}
.cat-header-icon{font-size:1.5rem}
.cat-header-info{flex:1}
.cat-header-name{font-size:1rem;font-weight:800}
.cat-header-count{font-size:.7rem;color:var(--teal);font-weight:700}

/* === FOOTER === */
.footer{text-align:center;padding:1.5rem 1rem;font-size:.65rem;color:var(--muted);
  border-top:1px solid var(--border);background:var(--surface)}
.footer a{color:var(--teal)}

/* === CROSS LINKS === */
.cross-links{margin:1rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:.75rem}
.cross-title{font-size:.72rem;font-weight:800;color:var(--teal);margin-bottom:.5rem;
  text-transform:uppercase;letter-spacing:.04em}
.cross-link{display:block;padding:.35rem .5rem;border-radius:6px;text-decoration:none;margin-bottom:.1rem}
.cross-link:hover{background:#f0fdfa}
.cross-url{font-size:.72rem;font-weight:700;color:var(--teal)}
.cross-desc{font-size:.62rem;color:var(--muted)}

/* === LOADING === */
.loading{text-align:center;padding:3rem 1rem;color:var(--muted)}
.loading-spinner{display:inline-block;width:24px;height:24px;border:3px solid var(--border);
  border-top-color:var(--teal);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* === SCROLL TOP === */
.scroll-top{position:fixed;bottom:calc(1rem + var(--safe-b));right:1rem;width:40px;height:40px;
  border-radius:50%;background:var(--teal);color:#fff;border:none;cursor:pointer;font-size:1.1rem;
  box-shadow:0 4px 12px rgba(0,0,0,.2);display:none;align-items:center;justify-content:center;z-index:50}
.scroll-top.show{display:flex}

/* === NO RESULTS === */
.no-results{text-align:center;padding:2rem 1rem;color:var(--muted)}
.no-results-icon{font-size:2.5rem;margin-bottom:.5rem}

/* === FEATURED SECTION === */
.featured{margin:.5rem 1rem 1rem;background:linear-gradient(135deg,#FDF2F8,#FAE8FF);
  border:1px solid #F0ABFC;border-radius:var(--r);padding:1rem;overflow:hidden}
.featured-title{font-size:.85rem;font-weight:800;color:#831843;margin-bottom:.5rem}
.featured-subtitle{font-size:.7rem;color:#9D174D;margin-bottom:.75rem}
.featured-scroll{display:flex;gap:.5rem;overflow-x:auto;-webkit-overflow-scrolling:touch;
  scrollbar-width:none;padding-bottom:.25rem}
.featured-scroll::-webkit-scrollbar{display:none}
.featured-card{flex-shrink:0;width:160px;background:var(--surface);border-radius:8px;
  padding:.6rem;border:1px solid #F0ABFC;cursor:pointer;transition:transform .15s}
.featured-card:hover{transform:translateY(-2px)}
.featured-card-name{font-size:.75rem;font-weight:700;color:var(--text);margin-bottom:.15rem;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.featured-card-desc{font-size:.62rem;color:var(--text-sm);line-height:1.3;
  display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:.2rem}
.featured-card-area{font-size:.58rem;color:var(--muted)}
.featured-card-cat{display:inline-block;font-size:.55rem;padding:.1rem .35rem;border-radius:8px;
  margin-top:.25rem;font-weight:600}

/* === RESPONSIVE === */
@media(min-width:640px){.hdr{padding:.75rem 1.5rem}}
@media(max-width:400px){.hdr-brand{font-size:.85rem}.hdr-search input{font-size:.78rem}}
</style>
</head>
<body>

<!-- === HEADER === -->
<header class="hdr" id="hdr">
  <button class="hdr-back" id="hdr-back" aria-label="Go back">&#8592;</button>
  <div class="hdr-brand">services.<span>stlucia</span>.studio</div>
  <div class="hdr-search">
    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
    <input type="search" id="search" placeholder="Search 823+ services..." autocomplete="off">
  </div>
</header>

<!-- === MAIN CONTENT (rendered by JS) === -->
<div id="app">
  <div class="loading"><div class="loading-spinner"></div><p style="margin-top:.5rem">Loading services...</p></div>
</div>

<!-- === TIKTOK EXPLORE VIEW === -->
<div class="explore-view" id="explore-view">
  <div class="explore-hdr">
    <button class="explore-close" id="explore-close" aria-label="Close">&#215;</button>
    <span class="explore-counter" id="explore-counter"></span>
    <div style="display:flex;gap:.4rem">
      <button class="explore-filter-btn" id="explore-filter-btn">Filter</button>
      <button class="explore-shuffle" id="explore-shuffle">Shuffle</button>
    </div>
  </div>
  <div class="explore-filters" id="explore-filters"></div>
  <div class="explore-scroll" id="explore-scroll"></div>
</div>

<button class="scroll-top" id="scroll-top" aria-label="Scroll to top">&#8593;</button>

<script src="assets/js/super-nav.js"></script>
<script>
(function(){
  var D = null;
  var app = document.getElementById('app');
  var searchInput = document.getElementById('search');
  var backBtn = document.getElementById('hdr-back');
  var scrollBtn = document.getElementById('scroll-top');
  var exploreView = document.getElementById('explore-view');
  var exploreScroll = document.getElementById('explore-scroll');
  var exploreCounter = document.getElementById('explore-counter');
  var exploreFilters = document.getElementById('explore-filters');

  var state = { view: 'home', group: null, subcat: null, query: '', personaId: null };
  var exploreServices = [];
  var exploreGroup = null;

  // --- Helpers (all user data escaped via textContent/esc before DOM insertion) ---
  function esc(s) {
    if (!s) return '';
    var d = document.createElement('div');
    d.textContent = s;
    return d.innerHTML;
  }
  function waNum(n) { return n ? n.replace(/[^0-9]/g, '') : ''; }
  function phoneHref(n) { return n ? 'tel:' + n.replace(/[^+0-9]/g, '') : ''; }
  function catColor(catId) {
    var c = D.categories[catId];
    return c ? c.bg : '#F1F5F9';
  }
  function catFg(catId) {
    var c = D.categories[catId];
    return c ? c.fg : '#334155';
  }
  function catLabel(catId) {
    var c = D.categories[catId];
    return c ? c.l : catId;
  }
  function groupIcon(gId) {
    var g = D.groups.find(function(x) { return x.id === gId; });
    return g ? g.icon : '\u{1F4CB}';
  }

  // --- Build service card using safe DOM methods ---
  function renderCard(s) {
    var el = document.createElement('div');
    el.className = 'card';
    el.style.borderLeftColor = catColor(s.c);

    var nameEl = document.createElement('div');
    nameEl.className = 'card-name';
    nameEl.textContent = s.n;
    el.appendChild(nameEl);

    if (s.d) {
      var descEl = document.createElement('div');
      descEl.className = 'card-desc';
      descEl.textContent = s.d;
      el.appendChild(descEl);
    }
    if (s.a) {
      var areaEl = document.createElement('div');
      areaEl.className = 'card-area';
      areaEl.textContent = '\u{1F4CD} ' + s.a;
      el.appendChild(areaEl);
    }

    var actions = document.createElement('div');
    actions.className = 'card-actions';
    if (s.p || s.w) {
      var callBtn = document.createElement('a');
      callBtn.href = phoneHref(s.p || s.w);
      callBtn.className = 'card-btn btn-call';
      callBtn.textContent = '\u{1F4DE} Call';
      actions.appendChild(callBtn);
    }
    if (s.w) {
      var waBtn = document.createElement('a');
      waBtn.href = 'https://wa.me/' + waNum(s.w);
      waBtn.target = '_blank';
      waBtn.rel = 'noopener';
      waBtn.className = 'card-btn btn-wa';
      waBtn.textContent = '\u{1F4AC} WhatsApp';
      actions.appendChild(waBtn);
    }
    if (s.u) {
      var webBtn = document.createElement('a');
      webBtn.href = s.u;
      webBtn.target = '_blank';
      webBtn.rel = 'noopener';
      webBtn.className = 'card-btn btn-web';
      webBtn.textContent = '\u{1F310} Web';
      actions.appendChild(webBtn);
    }
    el.appendChild(actions);

    var catEl = document.createElement('div');
    catEl.className = 'card-cat';
    catEl.textContent = groupIcon(s.g) + ' ' + s.g + ' \u2014 ' + catLabel(s.c);
    el.appendChild(catEl);

    return el;
  }

  // --- Build explore card using safe DOM methods ---
  function buildExploreCard(s, idx, gradient) {
    var el = document.createElement('div');
    el.className = 'explore-card';
    el.style.background = gradient;

    var iconEl = document.createElement('div');
    iconEl.className = 'explore-card-cat-icon';
    iconEl.textContent = groupIcon(s.g);
    el.appendChild(iconEl);

    var nameEl = document.createElement('div');
    nameEl.className = 'explore-card-name';
    nameEl.textContent = s.n;
    el.appendChild(nameEl);

    if (s.d) {
      var descEl = document.createElement('div');
      descEl.className = 'explore-card-desc';
      descEl.textContent = s.d;
      el.appendChild(descEl);
    }
    if (s.a) {
      var areaEl = document.createElement('div');
      areaEl.className = 'explore-card-area';
      areaEl.textContent = '\u{1F4CD} ' + s.a;
      el.appendChild(areaEl);
    }

    var actions = document.createElement('div');
    actions.className = 'explore-card-actions';
    if (s.p || s.w) {
      var callBtn = document.createElement('a');
      callBtn.href = phoneHref(s.p || s.w);
      callBtn.className = 'explore-card-btn';
      callBtn.textContent = '\u{1F4DE} Call';
      actions.appendChild(callBtn);
    }
    if (s.w) {
      var waBtn = document.createElement('a');
      waBtn.href = 'https://wa.me/' + waNum(s.w);
      waBtn.target = '_blank';
      waBtn.rel = 'noopener';
      waBtn.className = 'explore-card-btn';
      waBtn.textContent = '\u{1F4AC} WhatsApp';
      actions.appendChild(waBtn);
    }
    if (s.u) {
      var webBtn = document.createElement('a');
      webBtn.href = s.u;
      webBtn.target = '_blank';
      webBtn.rel = 'noopener';
      webBtn.className = 'explore-card-btn';
      webBtn.textContent = '\u{1F310} Website';
      actions.appendChild(webBtn);
    }
    el.appendChild(actions);

    var metaEl = document.createElement('div');
    metaEl.className = 'explore-card-meta';
    metaEl.textContent = s.g + ' \u2014 ' + catLabel(s.c);
    el.appendChild(metaEl);

    if (idx === 0) {
      var hint = document.createElement('div');
      hint.className = 'explore-swipe-hint';
      hint.textContent = '\u2195 swipe for more';
      el.appendChild(hint);
    }

    return el;
  }

  // --- Featured card (safe DOM) ---
  function buildFeaturedCard(s) {
    var fc = document.createElement('div');
    fc.className = 'featured-card';

    var nameEl = document.createElement('div');
    nameEl.className = 'featured-card-name';
    nameEl.textContent = s.n;
    fc.appendChild(nameEl);

    var descEl = document.createElement('div');
    descEl.className = 'featured-card-desc';
    descEl.textContent = s.d;
    fc.appendChild(descEl);

    if (s.a) {
      var areaEl = document.createElement('div');
      areaEl.className = 'featured-card-area';
      areaEl.textContent = s.a;
      fc.appendChild(areaEl);
    }

    var catEl = document.createElement('span');
    catEl.className = 'featured-card-cat';
    catEl.style.background = catColor(s.c);
    catEl.style.color = catFg(s.c);
    catEl.textContent = catLabel(s.c);
    fc.appendChild(catEl);

    fc.addEventListener('click', function() { navigateTo('category', 'Arts & Entertainment', s.c); });
    return fc;
  }

  // --- HOME VIEW ---
  function renderHome() {
    state = { view: 'home', group: null, subcat: null, query: '', personaId: null };
    backBtn.style.display = 'none';
    searchInput.value = '';
    window.scrollTo({ top: 0 });

    // Clear and build DOM safely
    app.textContent = '';

    // Stats bar
    var statsBar = document.createElement('div');
    statsBar.className = 'stats-bar';
    [{v: D.stats.total, l: 'Services'}, {v: D.stats.whatsapp, l: 'WhatsApp'}, {v: D.stats.categories, l: 'Categories'}].forEach(function(item) {
      var pill = document.createElement('div');
      pill.className = 'stat-pill';
      var strong = document.createElement('strong');
      strong.textContent = item.v;
      var small = document.createElement('small');
      small.textContent = item.l;
      pill.appendChild(strong);
      pill.appendChild(small);
      statsBar.appendChild(pill);
    });
    app.appendChild(statsBar);

    // Browse by category title
    var catTitle = document.createElement('div');
    catTitle.className = 'section-title';
    catTitle.textContent = 'Browse by Category';
    app.appendChild(catTitle);

    // Group grid
    var grid = document.createElement('div');
    grid.className = 'group-grid';
    D.groups.forEach(function(g) {
      if (g.count === 0) return;
      var card = document.createElement('div');
      card.className = 'group-card';

      var icon = document.createElement('span');
      icon.className = 'group-icon';
      icon.textContent = g.icon;
      card.appendChild(icon);

      var info = document.createElement('div');
      info.className = 'group-info';
      var name = document.createElement('div');
      name.className = 'group-name';
      name.textContent = g.id;
      var count = document.createElement('div');
      count.className = 'group-count';
      count.textContent = g.count + ' services';
      info.appendChild(name);
      info.appendChild(count);
      card.appendChild(info);

      card.addEventListener('click', function() { navigateTo('category', g.id); });
      grid.appendChild(card);
    });
    app.appendChild(grid);

    // Recently added title
    var recentTitle = document.createElement('div');
    recentTitle.className = 'section-title';
    recentTitle.id = 'recent-title';
    recentTitle.textContent = 'Recently Added';
    app.appendChild(recentTitle);

    // Recent cards
    var recentCards = document.createElement('div');
    recentCards.className = 'cards';
    recentCards.id = 'recent-cards';
    var recentCount = Math.min(12, D.stats.recentCount);
    for (var i = 0; i < recentCount; i++) {
      recentCards.appendChild(renderCard(D.services[i]));
    }
    app.appendChild(recentCards);

    // Featured arts section
    var artServices = D.services.filter(function(s) { return s.g === 'Arts & Entertainment'; });
    if (artServices.length > 0) {
      var feat = document.createElement('div');
      feat.className = 'featured';

      var featTitle = document.createElement('div');
      featTitle.className = 'featured-title';
      featTitle.textContent = '\u2728 Arts & Entertainment';
      feat.appendChild(featTitle);

      var featSub = document.createElement('div');
      featSub.className = 'featured-subtitle';
      featSub.textContent = artServices.length + ' artists, musicians, galleries, and performers';
      feat.appendChild(featSub);

      var fscroll = document.createElement('div');
      fscroll.className = 'featured-scroll';
      var shuffled = artServices.slice().sort(function() { return Math.random() - 0.5; }).slice(0, 20);
      shuffled.forEach(function(s) { fscroll.appendChild(buildFeaturedCard(s)); });
      feat.appendChild(fscroll);

      var browseLink = document.createElement('div');
      browseLink.style.cssText = 'margin-top:.5rem;text-align:right';
      var a = document.createElement('a');
      a.href = '#/category/Arts%20%26%20Entertainment';
      a.style.cssText = 'font-size:.72rem;font-weight:700;color:#831843';
      a.textContent = 'Browse all \u2192';
      browseLink.appendChild(a);
      feat.appendChild(browseLink);

      app.appendChild(feat);
    }

    // Persona strip title
    var personaTitle = document.createElement('div');
    personaTitle.className = 'section-title';
    personaTitle.textContent = 'Filter by Situation';
    app.appendChild(personaTitle);

    // Persona chips
    var pstrip = document.createElement('div');
    pstrip.className = 'persona-strip';
    D.personas.forEach(function(p) {
      var chip = document.createElement('div');
      chip.className = 'persona-chip';
      chip.textContent = p.icon + ' ' + p.label;
      chip.addEventListener('click', function() {
        document.querySelectorAll('.persona-chip').forEach(function(c) { c.classList.remove('active'); });
        if (state.personaId === p.id) {
          state.personaId = null;
          renderHome();
          return;
        }
        chip.classList.add('active');
        state.personaId = p.id;
        renderPersonaFiltered(p);
      });
      pstrip.appendChild(chip);
    });
    app.appendChild(pstrip);

    // Explore CTA
    var exploreCta = document.createElement('div');
    exploreCta.className = 'explore-cta';
    var ctaIcon = document.createElement('div');
    ctaIcon.className = 'explore-cta-icon';
    ctaIcon.textContent = '\u{1F4F1}';
    var ctaTitle = document.createElement('div');
    ctaTitle.className = 'explore-cta-title';
    ctaTitle.textContent = 'Explore Mode';
    var ctaSub = document.createElement('div');
    ctaSub.className = 'explore-cta-sub';
    ctaSub.textContent = 'Full-screen swipeable service catalog \u2014 TikTok style';
    exploreCta.appendChild(ctaIcon);
    exploreCta.appendChild(ctaTitle);
    exploreCta.appendChild(ctaSub);
    exploreCta.addEventListener('click', function() { openExplore(null); });
    app.appendChild(exploreCta);

    // Cross links
    var crossLinks = document.createElement('div');
    crossLinks.className = 'cross-links';
    var crossTitle = document.createElement('div');
    crossTitle.className = 'cross-title';
    crossTitle.textContent = 'More from stlucia.studio';
    crossLinks.appendChild(crossTitle);
    var links = [
      ['talent.stlucia.studio', 'Browse Saint Lucia\u2019s talent pool'],
      ['hire.stlucia.studio', 'Post jobs and manage hiring'],
      ['homes.stlucia.studio', 'Buy, sell, or rent property'],
      ['visit.stlucia.studio', 'Complete visitor guide'],
      ['living.stlucia.studio', 'Guide to living in Saint Lucia']
    ];
    links.forEach(function(l) {
      var link = document.createElement('a');
      link.href = 'https://' + l[0];
      link.className = 'cross-link';
      link.target = '_blank';
      link.rel = 'noopener';
      var urlSpan = document.createElement('span');
      urlSpan.className = 'cross-url';
      urlSpan.textContent = l[0];
      var descSpan = document.createElement('span');
      descSpan.className = 'cross-desc';
      descSpan.textContent = l[1];
      link.appendChild(urlSpan);
      link.appendChild(descSpan);
      crossLinks.appendChild(link);
    });
    app.appendChild(crossLinks);

    // Footer
    var footer = document.createElement('footer');
    footer.className = 'footer';
    var p1 = document.createElement('p');
    p1.textContent = '\u00A9 2026 stlucia.studio \u2014 Saint Lucia\u2019s Digital Ecosystem';
    var p2 = document.createElement('p');
    p2.style.marginTop = '.3rem';
    p2.textContent = D.stats.total + ' services \u00B7 ' + D.stats.whatsapp + ' with WhatsApp \u00B7 Updated ' + D.generated.split('T')[0];
    footer.appendChild(p1);
    footer.appendChild(p2);
    app.appendChild(footer);
  }

  // --- Persona filtered view ---
  function renderPersonaFiltered(p) {
    var filtered = D.services.filter(function(s) {
      return (p.subcats && p.subcats.indexOf(s.c) !== -1) || (p.groups && p.groups.indexOf(s.g) !== -1);
    });
    var recentTitle = document.getElementById('recent-title');
    var recentCards = document.getElementById('recent-cards');
    if (recentTitle) recentTitle.textContent = p.icon + ' ' + p.label + ' (' + filtered.length + ' services)';
    if (!recentCards) return;
    recentCards.textContent = '';
    var showCount = Math.min(30, filtered.length);
    for (var i = 0; i < showCount; i++) {
      recentCards.appendChild(renderCard(filtered[i]));
    }
    if (filtered.length > 30) {
      var more = document.createElement('div');
      more.style.cssText = 'text-align:center;padding:.75rem;';
      var moreLink = document.createElement('a');
      moreLink.href = '#';
      moreLink.style.cssText = 'font-size:.8rem;font-weight:700;color:var(--teal)';
      moreLink.textContent = 'Show all ' + filtered.length + ' \u2192';
      moreLink.addEventListener('click', function(e) {
        e.preventDefault();
        recentCards.textContent = '';
        filtered.forEach(function(s) { recentCards.appendChild(renderCard(s)); });
        more.remove();
      });
      more.appendChild(moreLink);
      recentCards.parentNode.insertBefore(more, recentCards.nextSibling);
    }
  }

  // --- CATEGORY VIEW ---
  function renderCategory(groupId, initialSubcat) {
    state.view = 'category';
    state.group = groupId;
    state.subcat = initialSubcat || null;
    backBtn.style.display = '';
    searchInput.value = '';
    window.scrollTo({ top: 0 });

    var group = D.groups.find(function(g) { return g.id === groupId; });
    var services = D.services.filter(function(s) { return s.g === groupId; });

    var subcats = {};
    services.forEach(function(s) {
      if (!subcats[s.c]) subcats[s.c] = 0;
      subcats[s.c]++;
    });

    app.textContent = '';

    // Category header
    var header = document.createElement('div');
    header.className = 'cat-header';
    var hIcon = document.createElement('span');
    hIcon.className = 'cat-header-icon';
    hIcon.textContent = group ? group.icon : '';
    var hInfo = document.createElement('div');
    hInfo.className = 'cat-header-info';
    var hName = document.createElement('div');
    hName.className = 'cat-header-name';
    hName.textContent = groupId;
    var hCount = document.createElement('div');
    hCount.className = 'cat-header-count';
    hCount.textContent = services.length + ' services';
    hInfo.appendChild(hName);
    hInfo.appendChild(hCount);
    header.appendChild(hIcon);
    header.appendChild(hInfo);
    app.appendChild(header);

    // Chip bar
    var chipBar = document.createElement('div');
    chipBar.className = 'chip-bar';

    var allChip = document.createElement('div');
    allChip.className = 'chip' + (!initialSubcat ? ' active' : '');
    allChip.style.cssText = 'background:#E2E8F0;color:#334155';
    allChip.textContent = 'All (' + services.length + ')';
    allChip.addEventListener('click', function() {
      state.subcat = null;
      chipBar.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
      allChip.classList.add('active');
      renderCategoryCards(cardsContainer, services);
      updateHash();
    });
    chipBar.appendChild(allChip);

    Object.entries(subcats).sort(function(a, b) { return b[1] - a[1]; }).forEach(function(entry) {
      var sc = entry[0], count = entry[1];
      var chip = document.createElement('div');
      chip.className = 'chip' + (initialSubcat === sc ? ' active' : '');
      chip.style.background = catColor(sc);
      chip.style.color = catFg(sc);
      chip.textContent = catLabel(sc) + ' (' + count + ')';
      chip.addEventListener('click', function() {
        state.subcat = sc;
        chipBar.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
        chip.classList.add('active');
        renderCategoryCards(cardsContainer, services.filter(function(s) { return s.c === sc; }));
        updateHash();
      });
      chipBar.appendChild(chip);
      if (initialSubcat === sc) allChip.classList.remove('active');
    });
    app.appendChild(chipBar);

    // Explore link
    var exploreLink = document.createElement('div');
    exploreLink.style.cssText = 'padding:.4rem 1rem';
    var eLink = document.createElement('a');
    eLink.href = '#';
    eLink.style.cssText = 'font-size:.72rem;font-weight:700;color:var(--teal)';
    eLink.textContent = '\u{1F4F1} Explore this category (swipe mode) \u2192';
    eLink.addEventListener('click', function(e) { e.preventDefault(); openExplore(groupId); });
    exploreLink.appendChild(eLink);
    app.appendChild(exploreLink);

    // Cards container
    var cardsContainer = document.createElement('div');
    cardsContainer.className = 'cards';
    var toShow = initialSubcat ? services.filter(function(s) { return s.c === initialSubcat; }) : services;
    renderCategoryCards(cardsContainer, toShow);
    app.appendChild(cardsContainer);
  }

  function renderCategoryCards(container, services) {
    container.textContent = '';
    if (services.length === 0) {
      var nr = document.createElement('div');
      nr.className = 'no-results';
      var nrIcon = document.createElement('div');
      nrIcon.className = 'no-results-icon';
      nrIcon.textContent = '\u{1F50D}';
      var nrText = document.createElement('p');
      nrText.textContent = 'No services found';
      nr.appendChild(nrIcon);
      nr.appendChild(nrText);
      container.appendChild(nr);
      return;
    }
    services.forEach(function(s) { container.appendChild(renderCard(s)); });
  }

  // --- SEARCH VIEW ---
  function renderSearch(query) {
    state.view = 'search';
    state.query = query;
    backBtn.style.display = '';
    window.scrollTo({ top: 0 });

    var q = query.toLowerCase();
    var results = D.services.filter(function(s) {
      return (s.n.toLowerCase().indexOf(q) !== -1) ||
             (s.d.toLowerCase().indexOf(q) !== -1) ||
             (s.a.toLowerCase().indexOf(q) !== -1) ||
             (catLabel(s.c).toLowerCase().indexOf(q) !== -1) ||
             (s.g.toLowerCase().indexOf(q) !== -1);
    });

    var groupCounts = {};
    results.forEach(function(s) { groupCounts[s.g] = (groupCounts[s.g] || 0) + 1; });

    app.textContent = '';

    // Result count
    var countDiv = document.createElement('div');
    countDiv.style.cssText = 'padding:.75rem 1rem .25rem;font-size:.82rem;color:var(--muted)';
    countDiv.textContent = results.length + ' result' + (results.length !== 1 ? 's' : '') + ' for "' + query + '"';
    app.appendChild(countDiv);

    // Chips
    var chipBar = document.createElement('div');
    chipBar.className = 'chip-bar';

    var allChip = document.createElement('div');
    allChip.className = 'chip active';
    allChip.style.cssText = 'background:#E2E8F0;color:#334155';
    allChip.textContent = 'All (' + results.length + ')';
    allChip.addEventListener('click', function() {
      chipBar.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
      allChip.classList.add('active');
      renderSearchCards(cardsContainer, results);
    });
    chipBar.appendChild(allChip);

    Object.entries(groupCounts).sort(function(a, b) { return b[1] - a[1]; }).forEach(function(entry) {
      var g = entry[0], count = entry[1];
      var grp = D.groups.find(function(x) { return x.id === g; });
      var chip = document.createElement('div');
      chip.className = 'chip';
      chip.style.cssText = 'background:var(--bg);color:var(--text)';
      chip.textContent = (grp ? grp.icon + ' ' : '') + g + ' (' + count + ')';
      chip.addEventListener('click', function() {
        chipBar.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
        chip.classList.add('active');
        renderSearchCards(cardsContainer, results.filter(function(s) { return s.g === g; }));
      });
      chipBar.appendChild(chip);
    });
    app.appendChild(chipBar);

    // Cards
    var cardsContainer = document.createElement('div');
    cardsContainer.className = 'cards';
    renderSearchCards(cardsContainer, results);
    app.appendChild(cardsContainer);
  }

  function renderSearchCards(container, services) {
    container.textContent = '';
    if (services.length === 0) {
      var nr = document.createElement('div');
      nr.className = 'no-results';
      var nrIcon = document.createElement('div');
      nrIcon.className = 'no-results-icon';
      nrIcon.textContent = '\u{1F50D}';
      var nrText = document.createElement('p');
      nrText.textContent = 'No services found';
      nr.appendChild(nrIcon);
      nr.appendChild(nrText);
      container.appendChild(nr);
      return;
    }
    services.forEach(function(s) { container.appendChild(renderCard(s)); });
  }

  // --- TIKTOK EXPLORE VIEW ---
  var gradients = [
    'linear-gradient(135deg,#0B1622,#0D7377)',
    'linear-gradient(135deg,#1a1a2e,#16213e)',
    'linear-gradient(135deg,#0f3057,#00587a)',
    'linear-gradient(135deg,#2d132c,#801336)',
    'linear-gradient(135deg,#1b262c,#0f4c75)',
    'linear-gradient(135deg,#2c003e,#512b58)',
    'linear-gradient(135deg,#1a1a2e,#e94560)',
    'linear-gradient(135deg,#065355,#11999E)'
  ];

  function openExplore(groupFilter) {
    exploreGroup = groupFilter;
    exploreServices = groupFilter
      ? D.services.filter(function(s) { return s.g === groupFilter; })
      : D.services.slice();
    shuffleArray(exploreServices);
    renderExploreCards();
    exploreView.classList.add('active');
    document.body.style.overflow = 'hidden';
    updateExploreCounter();

    // Build filter chips using safe DOM
    exploreFilters.textContent = '';
    var chipWrap = document.createElement('div');
    chipWrap.style.cssText = 'display:flex;flex-wrap:wrap;gap:.35rem;padding:.25rem';

    var groups = {};
    D.services.forEach(function(s) { groups[s.g] = (groups[s.g] || 0) + 1; });

    function makeFilterChip(label, filter, isActive) {
      var chip = document.createElement('div');
      chip.className = 'chip' + (isActive ? ' active' : '');
      chip.style.cssText = 'background:rgba(255,255,255,.1);color:#fff';
      chip.textContent = label;
      chip.addEventListener('click', function() {
        exploreFilters.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('active'); });
        chip.classList.add('active');
        exploreGroup = filter || null;
        exploreServices = filter ? D.services.filter(function(s) { return s.g === filter; }) : D.services.slice();
        shuffleArray(exploreServices);
        renderExploreCards();
        updateExploreCounter();
        exploreFilters.classList.remove('active');
      });
      return chip;
    }

    chipWrap.appendChild(makeFilterChip('All', '', !groupFilter));
    D.groups.forEach(function(g) {
      if (!groups[g.id]) return;
      chipWrap.appendChild(makeFilterChip(g.icon + ' ' + g.id, g.id, groupFilter === g.id));
    });
    exploreFilters.appendChild(chipWrap);
  }

  function renderExploreCards() {
    exploreScroll.textContent = '';
    exploreServices.forEach(function(s, i) {
      exploreScroll.appendChild(buildExploreCard(s, i, gradients[i % gradients.length]));
    });
  }

  function updateExploreCounter() {
    exploreCounter.textContent = exploreServices.length + ' services' + (exploreGroup ? ' in ' + exploreGroup : '');
  }

  function closeExplore() {
    exploreView.classList.remove('active');
    document.body.style.overflow = '';
  }

  function shuffleArray(arr) {
    for (var i = arr.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = arr[i]; arr[i] = arr[j]; arr[j] = temp;
    }
  }

  // --- NAVIGATION ---
  function navigateTo(view, param, param2) {
    if (view === 'home') {
      window.location.hash = '/';
    } else if (view === 'category') {
      var hash = '#/category/' + encodeURIComponent(param);
      if (param2) hash += '/' + encodeURIComponent(param2);
      window.location.hash = hash;
    } else if (view === 'search') {
      window.location.hash = '#/search/' + encodeURIComponent(param);
    }
  }

  function updateHash() {
    if (state.view === 'category') {
      var hash = '#/category/' + encodeURIComponent(state.group);
      if (state.subcat) hash += '/' + encodeURIComponent(state.subcat);
      history.replaceState(null, '', hash);
    }
  }

  function handleRoute() {
    var hash = window.location.hash || '#/';
    var parts = hash.replace('#/', '').split('/').map(decodeURIComponent);

    if (parts[0] === 'category' && parts[1]) {
      renderCategory(parts[1], parts[2] || null);
    } else if (parts[0] === 'search' && parts[1]) {
      searchInput.value = parts[1];
      renderSearch(parts[1]);
    } else {
      renderHome();
    }
  }

  // --- EVENTS ---
  var searchTimer;
  searchInput.addEventListener('keyup', function(e) {
    clearTimeout(searchTimer);
    var q = this.value.trim();
    if (e.key === 'Enter' && q.length >= 1) {
      navigateTo('search', q);
      return;
    }
    searchTimer = setTimeout(function() {
      if (q.length >= 2) navigateTo('search', q);
      else if (q.length === 0 && state.view === 'search') navigateTo('home');
    }, 300);
  });

  backBtn.addEventListener('click', function() {
    navigateTo('home');
  });

  // Scroll to top
  window.addEventListener('scroll', function() {
    scrollBtn.classList.toggle('show', window.scrollY > 500);
  });
  scrollBtn.addEventListener('click', function() { window.scrollTo({ top: 0, behavior: 'smooth' }); });

  // Explore controls
  document.getElementById('explore-close').addEventListener('click', closeExplore);
  document.getElementById('explore-shuffle').addEventListener('click', function() {
    shuffleArray(exploreServices);
    renderExploreCards();
    exploreScroll.scrollTo({ top: 0 });
  });
  document.getElementById('explore-filter-btn').addEventListener('click', function() {
    exploreFilters.classList.toggle('active');
  });

  // Keyboard nav for explore
  document.addEventListener('keydown', function(e) {
    if (!exploreView.classList.contains('active')) return;
    if (e.key === 'Escape') closeExplore();
    if (e.key === 'ArrowDown' || e.key === 'j') {
      e.preventDefault();
      exploreScroll.scrollBy({ top: window.innerHeight, behavior: 'smooth' });
    }
    if (e.key === 'ArrowUp' || e.key === 'k') {
      e.preventDefault();
      exploreScroll.scrollBy({ top: -window.innerHeight, behavior: 'smooth' });
    }
  });

  // Hash routing
  window.addEventListener('hashchange', handleRoute);

  // --- INIT ---
  fetch('data/data.json').then(function(r) { return r.json(); }).then(function(data) {
    D = data;
    searchInput.placeholder = 'Search ' + D.stats.total + '+ services...';
    handleRoute();
  }).catch(function(err) {
    app.textContent = '';
    var errDiv = document.createElement('div');
    errDiv.className = 'loading';
    errDiv.style.color = 'var(--coral)';
    var p1 = document.createElement('p');
    p1.textContent = 'Failed to load services data.';
    var p2 = document.createElement('p');
    p2.style.cssText = 'font-size:.7rem;margin-top:.5rem';
    p2.textContent = String(err);
    errDiv.appendChild(p1);
    errDiv.appendChild(p2);
    app.appendChild(errDiv);
  });
})();
</script>
</body>
</html>